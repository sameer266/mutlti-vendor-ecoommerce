{% extends 'dashboard/components/base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.css">
{% endblock %}

{% block content %}
<section>

  <!-- Page Heading -->
  <h1 class="text-2xl font-bold text-gray-900 mb-6">Admin Dashboard</h1>

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
    <!-- Users -->
    <div class="bg-white p-6 rounded-lg shadow border border-gray-200">
      <h3 class="font-semibold text-gray-700 mb-2">Users</h3>
      <p class="text-gray-600 text-sm">Total: {{ total_users }}</p>
      <p class="text-gray-600 text-sm">Customers: {{ customers_count }}</p>
      <p class="text-gray-600 text-sm">Vendors: {{ vendors_count }}</p>
      <p class="text-gray-600 text-sm">Admins: {{ admins_count }}</p>
    </div>

    <!-- Vendors -->
    <div class="bg-white p-6 rounded-lg shadow border border-gray-200">
      <h3 class="font-semibold text-gray-700 mb-2">Vendors</h3>
      <p class="text-gray-600 text-sm">Total: {{ total_vendors }}</p>
      <p class="text-gray-600 text-sm">Verified: {{ verified_vendors }}</p>
      <p class="text-gray-600 text-sm">Pending: {{ pending_vendors }}</p>
    </div>

    <!-- Products -->
    <div class="bg-white p-6 rounded-lg shadow border border-gray-200">
      <h3 class="font-semibold text-gray-700 mb-2">Products</h3>
      <p class="text-gray-600 text-sm">Total: {{ total_products }}</p>
      <p class="text-gray-600 text-sm">Active: {{ active_products }}</p>
      <p class="text-gray-600 text-sm">Low Stock: {{ low_stock_products }}</p>
    </div>

    <!-- Orders -->
    <div class="bg-white p-6 rounded-lg shadow border border-gray-200">
      <h3 class="font-semibold text-gray-700 mb-2">Orders</h3>
      <p class="text-gray-600 text-sm">Total: {{ total_orders }}</p>
      <p class="text-gray-600 text-sm">Pending: {{ pending_orders }}</p>
      <p class="text-gray-600 text-sm">Delivered: {{ delivered_orders }}</p>
      <p class="text-gray-600 text-sm">Revenue: Rs. {{ total_revenue }}</p>
    </div>

    <!-- Content -->
    <div class="bg-white p-6 rounded-lg shadow border border-gray-200">
      <h3 class="font-semibold text-gray-700 mb-2">Content</h3>
      <p class="text-gray-600 text-sm">Active Sliders: {{ active_sliders }}</p>
      <p class="text-gray-600 text-sm">Active Banners: {{ active_banners }}</p>
      <p class="text-gray-600 text-sm">Active Home Categories: {{ active_home_categories }}</p>
    </div>

    <!-- Others -->
    <div class="bg-white p-6 rounded-lg shadow border border-gray-200">
      <h3 class="font-semibold text-gray-700 mb-2">Others</h3>
      <p class="text-gray-600 text-sm">Reviews: {{ total_reviews }}</p>
      <p class="text-gray-600 text-sm">Unread Contacts: {{ unread_contacts }}</p>
      <p class="text-gray-600 text-sm">Newsletter Subscribers: {{ newsletter_subscribers }}</p>
      <p class="text-gray-600 text-sm">Unread Notifications: {{ unread_notifications }}</p>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <div class="bg-white p-6 rounded-lg shadow border border-gray-200">
      <h3 class="font-semibold text-gray-700 mb-4">User Breakdown</h3>
      <canvas id="userChart" class="w-full h-64"></canvas>
    </div>
    <div class="bg-white p-6 rounded-lg shadow border border-gray-200">
      <h3 class="font-semibold text-gray-700 mb-4">Vendor Status</h3>
      <canvas id="vendorChart" class="w-full h-64"></canvas>
    </div>
    <div class="bg-white p-6 rounded-lg shadow border border-gray-200">
      <h3 class="font-semibold text-gray-700 mb-4">Product Status</h3>
      <canvas id="productChart" class="w-full h-64"></canvas>
    </div>
    <div class="bg-white p-6 rounded-lg shadow border border-gray-200">
      <h3 class="font-semibold text-gray-700 mb-4">Order Status</h3>
      <canvas id="orderChart" class="w-full h-64"></canvas>
    </div>
  </div>

  <!-- Recent Activities -->
  <div class="bg-white p-6 rounded-lg shadow border border-gray-200">
    <h2 class="text-xl font-semibold text-gray-700 mb-4">Recent Activities</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
      <!-- Recent Orders -->
      <div>
        <h3 class="font-semibold text-gray-600 mb-2">Recent Orders</h3>
        <ul class="text-sm text-gray-600 space-y-1">
          {% for order in recent_orders %}
            <li>Order #{{ order.order_number }} - {{ order.status }} ({{ order.created_at|date:"M d, Y" }})</li>
          {% empty %}
            <li>No recent orders</li>
          {% endfor %}
        </ul>
      </div>

      <!-- Recent Products -->
      <div>
        <h3 class="font-semibold text-gray-600 mb-2">Recent Products</h3>
        <ul class="text-sm text-gray-600 space-y-1">
          {% for product in recent_products %}
            <li>{{ product.name }} - {{ product.vendor.shop_name }} ({{ product.created_at|date:"M d, Y" }})</li>
          {% empty %}
            <li>No recent products</li>
          {% endfor %}
        </ul>
      </div>

      <!-- Recent Sliders -->
      <div>
        <h3 class="font-semibold text-gray-600 mb-2">Recent Sliders</h3>
        <ul class="text-sm text-gray-600 space-y-1">
          {% for slider in recent_sliders %}
            <li>{{ slider.title  }} - {{ slider.is_active }} ({{ slider.created_at|date:"M d, Y" }})</li>
          {% empty %}
            <li>No recent sliders</li>
          {% endfor %}
        </ul>
      </div>

      <!-- Recent Banners -->
      <div>
        <h3 class="font-semibold text-gray-600 mb-2">Recent Banners</h3>
        <ul class="text-sm text-gray-600 space-y-1">
          {% for banner in recent_banners %}
            <li>{{ banner.title }} - {{ banner.is_active }} ({{ banner.created_at|date:"M d, Y" }})</li>
          {% empty %}
            <li>No recent banners</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

</section>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
<script>
  // User Breakdown
  new Chart(document.getElementById('userChart'), {
    type: 'pie',
    data: {
      labels: ['Customers', 'Vendors'],
      datasets: [{
        data: [{{ customers_count }}, {{ vendors_count }}],
        backgroundColor: ['#3b82f6','#10b981']
      }]
    }
  });

  // Vendor Status
  new Chart(document.getElementById('vendorChart'), {
    type: 'pie',
    data: {
      labels: ['Verified','Pending'],
      datasets: [{
        data: [{{ verified_vendors }}, {{ pending_vendors }}],
        backgroundColor: ['#10b981','#f59e0b']
      }]
    }
  });

  // Product Status
  new Chart(document.getElementById('productChart'), {
    type: 'bar',
    data: {
      labels: ['Total','Active','Low Stock'],
      datasets: [{
        label: 'Products',
        data: [{{ total_products }}, {{ active_products }}, {{ low_stock_products }}],
        backgroundColor: ['#3b82f6','#10b981','#f59e0b']
      }]
    },
    options: { responsive: true, plugins: { legend: { display: false } } }
  });

  // Order Status
  new Chart(document.getElementById('orderChart'), {
    type: 'bar',
    data: {
      labels: ['Total','Pending','Delivered'],
      datasets: [{
        label: 'Orders',
        data: [{{ total_orders }}, {{ pending_orders }}, {{ delivered_orders }}],
        backgroundColor: ['#3b82f6','#f59e0b','#10b981']
      }]
    },
    options: { responsive: true, plugins: { legend: { display: false } } }
  });
</script>
{% endblock %}
