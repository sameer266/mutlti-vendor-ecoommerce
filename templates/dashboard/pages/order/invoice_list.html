{% extends 'dashboard/components/base.html' %}
{% load static %}



{% block content %}
<div class="bg-white rounded-xl shadow p-6">
  <!-- Header -->
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
    <div>
      <h1 class="text-2xl font-semibold text-gray-800 flex items-center gap-3">
        <i class="fa-solid fa-file-invoice text-blue-600"></i>
        <span>Invoices for Order 
          <span class="text-blue-600">#{{ order_number }}</span>
        </span>
      </h1>
      <p class="mt-1 text-sm text-gray-500">
        {{ invoices|length }} Invoice{{ invoices|pluralize }}
      </p>
    </div>

    <a href="{% url 'admin_orders_list' %}"
       class="inline-flex items-center gap-2 bg-blue-600 border border-gray-200 text-white px-4 py-2 rounded-lg hover:bg-blue-500 transition">
      <i class="fa-solid fa-arrow-left"></i> Back to Orders
    </a>
  </div>

  <!-- Table -->
  <div class="overflow-x-auto">
    <table id="invoiceTable" class="min-w-full text-sm border border-gray-200 rounded-lg">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-3 text-left">Invoice #</th>
          <th class="px-4 py-3 text-left">Vendor</th>
          <th class="px-4 py-3 text-left">Customer</th>
          <th class="px-4 py-3 text-left">Subtotal</th>
          <th class="px-4 py-3 text-left">Tax</th>
          <th class="px-4 py-3 text-left">Total</th>
          <th class="px-4 py-3 text-left">Payment Status</th>
          <th class="px-4 py-3 text-left">Date</th>
          <th class="px-4 py-3 text-center">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for invoice in invoices %}
        <tr class="hover:bg-gray-50">
          <td class="px-4 py-3 font-medium">{{ invoice.invoice_number }}</td>
          
          <td class="px-4 py-3">
            {{ invoice.vendor.shop_name }}<br>
            <span class="text-xs text-gray-500">{{ invoice.vendor.email }}</span>
          </td>

          <td class="px-4 py-3">
            {{ invoice.customer.get_full_name }}<br>
            <span class="text-xs text-gray-500">{{ invoice.customer.email }}</span>
          </td>

          <td class="px-4 py-3">Rs {{ invoice.subtotal }}</td>
          <td class="px-4 py-3">Rs {{ invoice.tax_amount }}</td>
          <td class="px-4 py-3 font-semibold text-green-700">Rs {{ invoice.total }}</td>

          <td class="px-4 py-3">
            <span class="px-2 py-1 rounded-full text-xs font-medium
              {% if invoice.payment_status == 'paid' %}bg-green-100 text-green-700
              {% elif invoice.payment_status == 'pending' %}bg-yellow-100 text-yellow-700
              {% elif invoice.payment_status == 'failed' %}bg-red-100 text-red-700
              {% endif %}">
              {{ invoice.payment_status|capfirst }}
            </span>
          </td>

          <td class="px-4 py-3">{{ invoice.created_at|date:"Y-m-d h:i A" }}</td>

          <td class="px-4 py-3 text-center">
            <a href="{% url 'admin_invoice_detail' invoice.invoice_number %}" 
              class="text-blue-600 hover:text-blue-800" title="View Invoice">
              <i class="fa-solid fa-eye"></i>
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="9" class="text-center text-gray-500 py-6">
            No invoices found for this order.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block extra_js %}


<script>
  $(document).ready(function () {
    $('#invoiceTable').DataTable({
      responsive: true,
      pageLength: 10,
      order: [[7, 'desc']], // sort by Date column
      language: {
        search: "_INPUT_",
        searchPlaceholder: "Search invoices...",
        lengthMenu: "Show _MENU_ per page",
        info: "Showing _START_ to _END_ of _TOTAL_ invoices",
        zeroRecords: "No matching invoices found"
      },
      columnDefs: [
        { orderable: false, targets: [8] } // disable sorting on Actions
      ]
    });
  });
</script>
{% endblock %}
