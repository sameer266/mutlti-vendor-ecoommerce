{% extends 'dashboard/components/base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.css">
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto p-4 sm:p-6">

  <!-- Page Heading -->
  <div class="mb-6">
    <h1 class="text-2xl font-semibold text-gray-900">Admin Dashboard</h1>
    <p class="text-sm text-gray-500 mt-1">Overview of key metrics and statistics</p>
  </div>

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">

    <!-- Users Card -->
    <div class="bg-white border border-gray-200 rounded-lg p-5">
      <div class="flex items-center gap-3 mb-3">
        <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-users text-gray-900"></i>
        </div>
        <h3 class="font-semibold text-gray-900">Users</h3>
      </div>
      <div class="space-y-1">
        <p class="text-sm text-gray-600">Total: <span class="font-semibold text-gray-900">{{ total_users }}</span></p>
        <p class="text-sm text-gray-600">Customers: <span class="font-semibold text-gray-900">{{ customers_count }}</span></p>
        <p class="text-sm text-gray-600">Admins: <span class="font-semibold text-gray-900">{{ admins_count }}</span></p>
      </div>
    </div>

    <!-- Products Card -->
    <div class="bg-white border border-gray-200 rounded-lg p-5">
      <div class="flex items-center gap-3 mb-3">
        <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-boxes text-gray-900"></i>
        </div>
        <h3 class="font-semibold text-gray-900">Products</h3>
      </div>
      <div class="space-y-1">
        <p class="text-sm text-gray-600">Total: <span class="font-semibold text-gray-900">{{ total_products }}</span></p>
        <p class="text-sm text-gray-600">Active: <span class="font-semibold text-gray-900">{{ active_products }}</span></p>
        <p class="text-sm text-gray-600">Low Stock: <span class="font-semibold text-gray-900">{{ low_stock_products }}</span></p>
      </div>
    </div>

    <!-- Orders Card -->
    <div class="bg-white border border-gray-200 rounded-lg p-5">
      <div class="flex items-center gap-3 mb-3">
        <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-shopping-cart text-gray-900"></i>
        </div>
        <h3 class="font-semibold text-gray-900">Orders</h3>
      </div>
      <div class="space-y-1">
        <p class="text-sm text-gray-600">Total: <span class="font-semibold text-gray-900">{{ total_orders }}</span></p>
        <p class="text-sm text-gray-600">Pending: <span class="font-semibold text-gray-900">{{ pending_orders }}</span></p>
        <p class="text-sm text-gray-600">Delivered: <span class="font-semibold text-gray-900">{{ delivered_orders }}</span></p>
        <p class="text-sm text-gray-600">Revenue: <span class="font-semibold text-gray-900">Rs. {{ total_revenue|floatformat:2 }}</span></p>
      </div>
    </div>

  </div>

  <!-- Charts Section -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">

    <!-- User Breakdown Pie -->
    <div class="bg-white border border-gray-200 rounded-lg p-5">
      <h3 class="font-semibold text-gray-900 mb-4 flex items-center gap-2">
        <i class="fas fa-users text-gray-600"></i> User Breakdown
      </h3>
      <canvas id="userChart" class="w-full h-64 sm:h-72"></canvas>
    </div>

    <!-- Product Status Bar -->
    <div class="bg-white border border-gray-200 rounded-lg p-5">
      <h3 class="font-semibold text-gray-900 mb-4 flex items-center gap-2">
        <i class="fas fa-boxes text-gray-600"></i> Product Status
      </h3>
      <canvas id="productChart" class="w-full h-64 sm:h-72"></canvas>
    </div>

    <!-- Order Status Bar -->
    <div class="bg-white border border-gray-200 rounded-lg p-5">
      <h3 class="font-semibold text-gray-900 mb-4 flex items-center gap-2">
        <i class="fas fa-shopping-cart text-gray-600"></i> Order Status
      </h3>
      <canvas id="orderChart" class="w-full h-64 sm:h-72"></canvas>
    </div>

    <!-- Last 30 Days Revenue Line Chart -->
    <div class="bg-white border border-gray-200 rounded-lg p-5 col-span-1 lg:col-span-2">
      <h3 class="font-semibold text-gray-900 mb-4 flex items-center gap-2">
        <i class="fas fa-chart-line text-gray-600"></i> Revenue (Last 30 Days)
      </h3>
      <canvas id="revenueChart" class="w-full h-72"></canvas>
    </div>

  </div>

</section>
{% endblock %}

{% block extra_js %}

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script>
$(function() {
  // Global defaults
  Chart.defaults.font.family = "'Inter', sans-serif";
  Chart.defaults.plugins.tooltip.backgroundColor = 'rgba(0,0,0,0.7)';

  // Pie charts
  new Chart($('#userChart'), {
    type: 'doughnut',
    data: {
      labels: ['Customers'],
      datasets: [{
        data: [{{ customers_count|default:0 }}],
        backgroundColor: ['#3b82f6'],
        hoverOffset: 10
      }]
    },
    options: { cutout: '70%', plugins: { legend: { position: 'bottom' }, title: { display: true, text: 'Users' } } }
  });

  // Bar charts
  new Chart($('#productChart'), {
    type: 'bar',
    data: {
      labels: ['Total','Active','Low Stock'],
      datasets: [{
        label: 'Products',
        data: [{{ total_products|default:0 }}, {{ active_products|default:0 }}, {{ low_stock_products|default:0 }}],
        backgroundColor: ['#3b82f6','#10b981','#f59e0b'],
        borderRadius: 6,
        hoverBackgroundColor: ['#2563eb','#059669','#b45309']
      }]
    },
    options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
  });

  new Chart($('#orderChart'), {
    type: 'bar',
    data: {
      labels: ['Total','Pending','Delivered'],
      datasets: [{
        label: 'Orders',
        data: [{{ total_orders|default:0 }}, {{ pending_orders|default:0 }}, {{ delivered_orders|default:0 }}],
        backgroundColor: ['#3b82f6','#f59e0b','#10b981'],
        borderRadius: 6,
        hoverBackgroundColor: ['#2563eb','#d97706','#059669']
      }]
    },
    options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
  });

  // Line chart for last 30 days revenue
  const revCtx = $('#revenueChart')[0].getContext('2d');
  const gradient = revCtx.createLinearGradient(0, 0, 0, 400);
  gradient.addColorStop(0, 'rgba(16,185,129,0.5)');
  gradient.addColorStop(1, 'rgba(16,185,129,0)');

  new Chart(revCtx, {
    type: 'line',
    data: {
      labels: {{ revenue_labels|safe|default:"[]" }},
      datasets: [{
        label: 'Revenue (Rs)',
        data: {{ revenue_data|safe|default:"[]" }},
        fill: true,
        borderColor: '#10b981',
        backgroundColor: gradient,
        tension: 0.3,
        pointBackgroundColor: '#10b981',
        pointRadius: 4,
        pointHoverRadius: 6
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false }, title: { display: true, text: 'Last 30 Days Revenue' } },
      scales: {
        y: { beginAtZero: true, title: { display: true, text: 'Revenue (Rs)' } },
        x: { title: { display: true, text: 'Date' } }
      }
    }
  });
});
</script>
{% endblock %}