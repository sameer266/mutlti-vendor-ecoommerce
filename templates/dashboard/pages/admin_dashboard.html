{% extends 'dashboard/components/base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.css">
{% endblock %}

{% block content %}
<section class="px-4 sm:px-6 lg:px-8 py-6">

  <!-- Page Heading -->
  <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-6 flex items-center gap-2">
    <i class="fas fa-tachometer-alt text-blue-600"></i> Admin Dashboard
  </h1>

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">

    <!-- Users Card -->
    <div class="bg-white p-5 rounded-lg shadow-md border border-gray-200 hover:shadow-lg transition flex flex-col gap-2">
      <h3 class="font-semibold text-gray-700 mb-2"><i class="fas fa-users mr-2 text-blue-500"></i> Users</h3>
      <p class="text-gray-600 text-sm">Total: <span class="font-bold">{{ total_users }}</span></p>
      <p class="text-gray-600 text-sm">Customers: <span class="font-bold text-blue-500">{{ customers_count }}</span></p>
      <p class="text-gray-600 text-sm">Vendors: <span class="font-bold text-green-500">{{ vendors_count }}</span></p>
      <p class="text-gray-600 text-sm">Admins: <span class="font-bold text-yellow-500">{{ admins_count }}</span></p>
    </div>

    <!-- Vendors Card -->
    <div class="bg-white p-5 rounded-lg shadow-md border border-gray-200 hover:shadow-lg transition flex flex-col gap-2">
      <h3 class="font-semibold text-gray-700 mb-2"><i class="fas fa-store mr-2 text-green-500"></i> Vendors</h3>
      <p class="text-gray-600 text-sm">Total: <span class="font-bold">{{ total_vendors }}</span></p>
      <p class="text-gray-600 text-sm">Verified: <span class="font-bold text-green-600">{{ verified_vendors }}</span></p>
      <p class="text-gray-600 text-sm">Pending: <span class="font-bold text-yellow-600">{{ pending_vendors }}</span></p>
    </div>

    <!-- Products Card -->
    <div class="bg-white p-5 rounded-lg shadow-md border border-gray-200 hover:shadow-lg transition flex flex-col gap-2">
      <h3 class="font-semibold text-gray-700 mb-2"><i class="fas fa-boxes mr-2 text-purple-500"></i> Products</h3>
      <p class="text-gray-600 text-sm">Total: <span class="font-bold">{{ total_products }}</span></p>
      <p class="text-gray-600 text-sm">Active: <span class="font-bold text-green-600">{{ active_products }}</span></p>
      <p class="text-gray-600 text-sm">Low Stock: <span class="font-bold text-red-600">{{ low_stock_products }}</span></p>
    </div>

    <!-- Orders Card -->
    <div class="bg-white p-5 rounded-lg shadow-md border border-gray-200 hover:shadow-lg transition flex flex-col gap-2">
      <h3 class="font-semibold text-gray-700 mb-2"><i class="fas fa-shopping-cart mr-2 text-orange-500"></i> Orders</h3>
      <p class="text-gray-600 text-sm">Total: <span class="font-bold">{{ total_orders }}</span></p>
      <p class="text-gray-600 text-sm">Pending: <span class="font-bold text-yellow-600">{{ pending_orders }}</span></p>
      <p class="text-gray-600 text-sm">Delivered: <span class="font-bold text-green-600">{{ delivered_orders }}</span></p>
      <p class="text-gray-600 text-sm">Revenue: <span class="font-bold text-blue-600">Rs. {{ total_revenue }}</span></p>
    </div>

  </div>

  <!-- Charts Section -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">

    <!-- Users Breakdown Pie -->
    <div class="bg-white p-5 rounded-lg shadow-md border border-gray-200 hover:shadow-lg transition">
      <h3 class="font-semibold text-gray-700 mb-4 flex items-center gap-2">
        <i class="fas fa-users text-blue-500"></i> User Breakdown
      </h3>
      <canvas id="userChart" class="w-full h-64 sm:h-72"></canvas>
    </div>

    <!-- Vendor Status Pie -->
    <div class="bg-white p-5 rounded-lg shadow-md border border-gray-200 hover:shadow-lg transition">
      <h3 class="font-semibold text-gray-700 mb-4 flex items-center gap-2">
        <i class="fas fa-store text-green-500"></i> Vendor Status
      </h3>
      <canvas id="vendorChart" class="w-full h-64 sm:h-72"></canvas>
    </div>

    <!-- Product Status Bar -->
    <div class="bg-white p-5 rounded-lg shadow-md border border-gray-200 hover:shadow-lg transition">
      <h3 class="font-semibold text-gray-700 mb-4 flex items-center gap-2">
        <i class="fas fa-boxes text-purple-500"></i> Product Status
      </h3>
      <canvas id="productChart" class="w-full h-64 sm:h-72"></canvas>
    </div>

    <!-- Order Status Bar -->
    <div class="bg-white p-5 rounded-lg shadow-md border border-gray-200 hover:shadow-lg transition">
      <h3 class="font-semibold text-gray-700 mb-4 flex items-center gap-2">
        <i class="fas fa-shopping-cart text-orange-500"></i> Order Status
      </h3>
      <canvas id="orderChart" class="w-full h-64 sm:h-72"></canvas>
    </div>

    <!-- Last 30 Days Revenue Line Chart -->
    <div class="bg-white p-5 rounded-lg shadow-md border border-gray-200 hover:shadow-lg transition col-span-1 lg:col-span-2">
      <h3 class="font-semibold text-gray-700 mb-4 flex items-center gap-2">
        <i class="fas fa-chart-line text-green-500"></i> Revenue (Last 30 Days)
      </h3>
      <canvas id="revenueChart" class="w-full h-72"></canvas>
    </div>

  </div>

</section>
{% endblock %}

{% block extra_js %}

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script>
$(function() {
  // Global defaults
  Chart.defaults.font.family = "'Inter', sans-serif";
  Chart.defaults.plugins.tooltip.backgroundColor = 'rgba(0,0,0,0.7)';

  // Pie charts
  new Chart($('#userChart'), {
    type: 'doughnut',
    data: {
      labels: ['Customers', 'Vendors'],
      datasets: [{
        data: [{{ customers_count|default:0 }}, {{ vendors_count|default:0 }}],
        backgroundColor: ['#3b82f6','#10b981'],
        hoverOffset: 10
      }]
    },
    options: { cutout: '70%', plugins: { legend: { position: 'bottom' }, title: { display: true, text: 'Users' } } }
  });

  new Chart($('#vendorChart'), {
    type: 'doughnut',
    data: {
      labels: ['Verified', 'Pending'],
      datasets: [{
        data: [{{ verified_vendors|default:0 }}, {{ pending_vendors|default:0 }}],
        backgroundColor: ['#10b981','#f59e0b'],
        hoverOffset: 10
      }]
    },
    options: { cutout: '70%', plugins: { legend: { position: 'bottom' }, title: { display: true, text: 'Vendors' } } }
  });

  // Bar charts
  new Chart($('#productChart'), {
    type: 'bar',
    data: {
      labels: ['Total','Active','Low Stock'],
      datasets: [{
        label: 'Products',
        data: [{{ total_products|default:0 }}, {{ active_products|default:0 }}, {{ low_stock_products|default:0 }}],
        backgroundColor: ['#3b82f6','#10b981','#f59e0b'],
        borderRadius: 6,
        hoverBackgroundColor: ['#2563eb','#059669','#b45309']
      }]
    },
    options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
  });

  new Chart($('#orderChart'), {
    type: 'bar',
    data: {
      labels: ['Total','Pending','Delivered'],
      datasets: [{
        label: 'Orders',
        data: [{{ total_orders|default:0 }}, {{ pending_orders|default:0 }}, {{ delivered_orders|default:0 }}],
        backgroundColor: ['#3b82f6','#f59e0b','#10b981'],
        borderRadius: 6,
        hoverBackgroundColor: ['#2563eb','#d97706','#059669']
      }]
    },
    options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
  });

  // Line chart for last 30 days revenue
  const revCtx = $('#revenueChart')[0].getContext('2d');
  const gradient = revCtx.createLinearGradient(0, 0, 0, 400);
  gradient.addColorStop(0, 'rgba(16,185,129,0.5)');
  gradient.addColorStop(1, 'rgba(16,185,129,0)');

  new Chart(revCtx, {
    type: 'line',
    data: {
      labels: {{ revenue_labels|safe|default:"[]" }},
      datasets: [{
        label: 'Revenue (Rs)',
        data: {{ revenue_data|safe|default:"[]" }},
        fill: true,
        borderColor: '#10b981',
        backgroundColor: gradient,
        tension: 0.3,
        pointBackgroundColor: '#10b981',
        pointRadius: 4,
        pointHoverRadius: 6
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false }, title: { display: true, text: 'Last 30 Days Revenue' } },
      scales: {
        y: { beginAtZero: true, title: { display: true, text: 'Revenue (Rs)' } },
        x: { title: { display: true, text: 'Date' } }
      }
    }
  });
});
</script>
{% endblock %}
