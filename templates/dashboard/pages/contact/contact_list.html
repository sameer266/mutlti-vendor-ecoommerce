{% extends 'dashboard/components/base.html' %}
{% load static %}

{% block content %}
<div class="p-6 bg-gray-100 min-h-screen">

  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-semibold text-gray-800 flex items-center gap-2">
      <i class="fas fa-envelope"></i> Contact Messages
    </h1>
  </div>

  <!-- Contact Table -->
  <div class="bg-white rounded-xl shadow overflow-x-auto p-4">
    <table id="contactTable" class="w-full text-sm table-auto">
      <thead class="bg-gray-50 text-gray-700">
        <tr>
          <th class="px-4 py-2 text-center">Read</th>
          <th class="px-4 py-2 text-left">Name</th>
          <th class="px-4 py-2 text-left">Email</th>
          <th class="px-4 py-2 text-left">Phone</th>
          <th class="px-4 py-2 text-left">Subject</th>
          <th class="px-4 py-2 text-left">Message</th>
          <th class="px-4 py-2 text-left">Date</th>
          <th class="px-4 py-2 text-center">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for contact in contacts %}
        <tr class="border-b hover:bg-gray-50">
          <!-- Read Checkbox -->
          <td class="px-4 py-2 text-center">
            <input type="checkbox" disabled {% if contact.is_read %}checked{% endif %}>
          </td>
          
          <!-- Contact Info -->
          <td class="px-4 py-2 font-medium">{{ contact.name }}</td>
          <td class="px-4 py-2">{{ contact.email }}</td>
          <td class="px-4 py-2">{{ contact.phone|default:"-" }}</td>
          <td class="px-4 py-2">{{ contact.subject|default:"-" }}</td>
          <td class="px-4 py-2 text-gray-700 max-w-xs truncate">{{ contact.message|truncatechars:60 }}</td>
          <td class="px-4 py-2 text-gray-500 text-sm">{{ contact.created_at|date:"M d, Y H:i" }}</td>

          <!-- Actions -->
          <td class="px-4 py-2 text-center flex justify-center gap-2">
            <!-- Toggle Read/Unread -->
            {% if not contact.is_read %}
            <a href="{% url 'admin_read_contacts' %}?id={{ contact.id }}&is_read=True"
               class="flex items-center gap-1 text-green-600 hover:text-green-800 transition"
               title="Mark as Read"
               onclick="return confirm('Mark this message as read?');">
              <i class="fas fa-check-circle"></i> Read
            </a>
            {% else %}
            <a href="{% url 'admin_read_contacts' %}?id={{ contact.id }}&is_read=False"
               class="flex items-center gap-1 text-yellow-600 hover:text-yellow-800 transition"
               title="Mark as Unread"
               onclick="return confirm('Mark this message as unread?');">
              <i class="fas fa-circle"></i> Unread
            </a>
            {% endif %}

            <!-- Delete -->
            <a href="{% url 'admin_contact_delete' contact.id %}"
               class="flex items-center gap-1 text-red-600 hover:text-red-800 transition"
               title="Delete"
               onclick="return confirm('Are you sure you want to delete this message?');">
              <i class="fas fa-trash-alt"></i> Delete
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" class="text-center py-4 text-gray-500">No contact messages found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
{% endblock %}

{% block extra_js %}
<script>
  $(document).ready(function() {
    $('#contactTable').DataTable({
      pageLength: 10,
      lengthChange: true,
      searching: true,
      ordering: true,
      responsive: true,
      language: {
        search: "_INPUT_",
        searchPlaceholder: "Search contacts..."
      },
      columnDefs: [{ orderable: false, targets: [0, 7] }] // Disable ordering for checkbox & actions
    });
  });
</script>
{% endblock %}
