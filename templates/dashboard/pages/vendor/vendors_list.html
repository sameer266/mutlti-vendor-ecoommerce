{% extends 'dashboard/components/base.html' %}

{% load static %}

{% block content %}
<div class="bg-white rounded-xl shadow p-6">
  <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between mb-4">
    <h1 class="text-2xl font-semibold text-gray-800">Vendors</h1>
    <div class="flex items-center gap-2 w-full md:w-auto">
      <a href="{% url 'admin_vendor_add' %}" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">+ Add Vendor</a>
    </div>
  </div>

  <form method="get" class="mb-5 grid grid-cols-1 md:grid-cols-3 gap-3">
    <input type="text" name="search" value="{{ request.GET.search }}" placeholder="Search by shop, email, phone, owner" class="border border-gray-300 rounded-lg px-3 py-2 w-full" />
    <select name="status" class="border border-gray-300 rounded-lg px-3 py-2 w-full">
      <option value="">All Status</option>
      <option value="pending" {% if request.GET.status == 'pending' %}selected{% endif %}>Pending</option>
      <option value="verified" {% if request.GET.status == 'verified' %}selected{% endif %}>Verified</option>
      <option value="rejected" {% if request.GET.status == 'rejected' %}selected{% endif %}>Rejected</option>
    </select>
    <div class="flex gap-2">
      <button class="bg-gray-800 text-white px-4 py-2 rounded-lg w-full md:w-auto">Filter</button>
      <a href="?" class="px-4 py-2 rounded-lg border w-full md:w-auto">Reset</a>
    </div>
  </form>

  <div class="overflow-x-auto">
    <table class="w-full border border-gray-200 rounded-lg text-sm">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-3 text-left">Shop</th>
          <th class="px-4 py-3 text-left">Owner</th>
          <th class="px-4 py-3 text-left">Contact</th>
          <th class="px-4 py-3 text-left">Location</th>
          <th class="px-4 py-3 text-left">PAN / Docs</th>
          <th class="px-4 py-3 text-left">Bank</th>
          <th class="px-4 py-3 text-left">Status</th>
          <th class="px-4 py-3 text-left">Created</th>
          <th class="px-4 py-3 text-center">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for vendor in vendors %}
        <tr class="hover:bg-gray-50 align-top">
          <td class="px-4 py-3">
            <div class="flex items-center gap-3">
              {% if vendor.shop_logo %}
                <img src="{{ vendor.shop_logo.url }}" alt="logo" class="w-10 h-10 object-cover rounded" />
              {% endif %}
              <div>
                <div class="font-semibold">{{ vendor.shop_name }}</div>
                <div class="text-xs text-gray-500">Slug: {{ vendor.slug }}</div>
                {% if vendor.shop_banner %}
                  <a href="{{ vendor.shop_banner.url }}" target="_blank" class="text-xs text-blue-600">View banner</a>
                {% endif %}
                {% if vendor.description %}
                  <div class="text-xs text-gray-600 mt-1 line-clamp-2">{{ vendor.description }}</div>
                {% endif %}
              </div>
            </div>
          </td>
          <td class="px-4 py-3">
            {% if vendor.user %}
              <div class="font-medium">{{ vendor.user.username }}</div>
            {% else %}
              <span class="text-gray-400">N/A</span>
            {% endif %}
          </td>
          <td class="px-4 py-3">
            <div>{{ vendor.email }}</div>
            <div class="text-gray-600">{{ vendor.phone }}</div>
          </td>
          <td class="px-4 py-3">
            <div>{{ vendor.address }}</div>
            <div class="text-gray-600">{{ vendor.city }}, {{ vendor.get_province_display }}</div>
          </td>
          <td class="px-4 py-3">
            <div class="text-gray-800">PAN: {{ vendor.pan_number }}</div>
            {% if vendor.pan_document %}
              <a href="{{ vendor.pan_document.url }}" target="_blank" class="text-blue-600 text-xs">View PAN</a>
            {% endif %}
            {% if vendor.citizenship_number %}
              <div class="text-gray-800 mt-1 text-xs">Citizenship: {{ vendor.citizenship_number }}</div>
              <div class="flex gap-2 mt-1">
                {% if vendor.citizenship_front %}<a href="{{ vendor.citizenship_front.url }}" target="_blank" class="text-blue-600 text-xs">Front</a>{% endif %}
                {% if vendor.citizenship_back %}<a href="{{ vendor.citizenship_back.url }}" target="_blank" class="text-blue-600 text-xs">Back</a>{% endif %}
              </div>
            {% endif %}
            {% if vendor.company_registration %}
              <div class="mt-1"><a href="{{ vendor.company_registration.url }}" target="_blank" class="text-blue-600 text-xs">Company Reg.</a></div>
            {% endif %}
          </td>
          <td class="px-4 py-3">
            {% if vendor.bank_name %}<div>{{ vendor.bank_name }}</div>{% endif %}
            {% if vendor.bank_account_number %}<div class="text-gray-600">{{ vendor.bank_account_number }}</div>{% endif %}
            {% if vendor.bank_account_holder %}<div class="text-gray-600">{{ vendor.bank_account_holder }}</div>{% endif %}
          </td>
          <td class="px-4 py-3">
            <div class="mb-1">
              {% if vendor.verification_status == 'verified' %}
                <span class="bg-green-100 text-green-700 px-2 py-0.5 rounded-full text-xs font-semibold">Verified</span>
              {% elif vendor.verification_status == 'pending' %}
                <span class="bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded-full text-xs font-semibold">Pending</span>
              {% elif vendor.verification_status == 'rejected' %}
                <span class="bg-red-100 text-red-700 px-2 py-0.5 rounded-full text-xs font-semibold">Rejected</span>
              {% endif %}
            </div>
            <div class="text-xs text-gray-600">Active: {{ vendor.is_active|yesno:"Yes,No" }}</div>
            {% if vendor.verified_at %}
              <div class="text-xs text-gray-600">Verified: {{ vendor.verified_at|date:"Y-m-d H:i" }}</div>
            {% endif %}
            {% if vendor.rejection_reason %}
              <div class="text-xs text-red-600 mt-1">Reason: {{ vendor.rejection_reason }}</div>
            {% endif %}
          </td>
          <td class="px-4 py-3">{{ vendor.created_at|date:"Y-m-d H:i" }}</td>
          <td class="px-4 py-3 text-center">
            <a href="{% url 'admin_vendor_update' vendor.id %}" class="text-blue-600 hover:text-blue-800 font-medium">Edit</a>
            |
            <a href="{% url 'admin_vendor_delete' vendor.id %}" onclick="return confirm('Delete this vendor?')" class="text-red-600 hover:text-red-800 font-medium">Delete</a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="9" class="text-center text-gray-500 py-6">No vendors found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

