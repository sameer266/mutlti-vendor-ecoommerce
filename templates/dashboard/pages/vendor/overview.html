{% extends 'dashboard/components/base.html' %}
{% load static %}

{% block content %}
<div class="space-y-6">

  <!-- Header & Commission -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <h1 class="text-2xl font-semibold text-gray-800"><i class="fas fa-wallet"></i> Vendor Payments Overview</h1>
    <div class="bg-blue-50 text-blue-700 px-4 py-2 rounded-lg text-sm font-medium border border-blue-200 shadow-sm">
      Platform Commission Rate: <span class="font-semibold">{{ commission_rate_percent }}%</span>
    </div>
  </div>

  <!-- Summary Cards with Font Awesome Icons -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
    <div class="bg-white rounded-xl shadow p-4 flex items-center gap-3">
      <i class="fas fa-coins text-3xl text-yellow-500"></i>
      <div>
        <div class="text-gray-500 text-sm">Total Platform Revenue</div>
        <div class="text-2xl font-semibold mt-1">Rs. {{ total_platform_revenue }}</div>
      </div>
    </div>
    <div class="bg-white rounded-xl shadow p-4 flex items-center gap-3">
      <i class="fas fa-wallet text-3xl text-green-500"></i>
      <div>
        <div class="text-gray-500 text-sm">Total Vendor Earnings</div>
        <div class="text-2xl font-semibold mt-1">Rs. {{ total_vendor_earnings }}</div>
      </div>
    </div>
    <div class="bg-white rounded-xl shadow p-4 flex items-center gap-3">
      <i class="fas fa-hand-holding-usd text-3xl text-blue-500"></i>
      <div>
        <div class="text-gray-500 text-sm">Total Payouts Completed</div>
        <div class="text-2xl font-semibold mt-1">Rs. {{ total_payouts }}</div>
      </div>
    </div>
    <div class="bg-white rounded-xl shadow p-4 flex items-center gap-3">
      <i class="fas fa-hourglass-half text-3xl text-red-500"></i>
      <div>
        <div class="text-gray-500 text-sm">Pending Vendor Payments</div>
        <div class="text-2xl font-semibold mt-1">Rs. {{ pending_total }}</div>
      </div>
    </div>
  </div>

  <!-- Filter Form -->
  <form method="get" class="bg-white rounded-xl shadow p-4 grid grid-cols-1 md:grid-cols-4 gap-3">
    <input type="text" name="search" value="{{ request.GET.search }}" placeholder="Search by vendor name..." class="border border-gray-300 rounded-lg px-3 py-2 w-full" />
    <input type="date" name="from" value="{{ request.GET.from }}" class="border border-gray-300 rounded-lg px-3 py-2 w-full" />
    <input type="date" name="to" value="{{ request.GET.to }}" class="border border-gray-300 rounded-lg px-3 py-2 w-full" />
    <div class="flex gap-2">
      <button class="bg-gray-800 text-white px-4 py-2 rounded-lg w-full md:w-auto hover:bg-gray-900 transition">Apply Filters</button>
      <a href="?" class="px-4 py-2 rounded-lg border w-full md:w-auto hover:bg-gray-100 transition">Reset</a>
    </div>
  </form>

  <!-- Vendor Payments Table -->
  <div class="bg-white rounded-xl shadow p-4 overflow-x-auto">
    <table id="vendorPaymentsTable" class="w-full text-sm">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-3 text-left">Vendor</th>
          <th class="px-4 py-3 text-left">Total Orders Revenue</th>
          <th class="px-4 py-3 text-left">Admin Commission ({{ commission_rate_percent }}%)</th>
          <th class="px-4 py-3 text-left">Vendor Earnings</th>
          <th class="px-4 py-3 text-left">Wallet Balance</th>
          <th class="px-4 py-3 text-left">Pending Payout</th>
          <th class="px-4 py-3 text-center">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for row in vendor_rows %}
        <tr class="hover:bg-gray-50">
          <td class="px-4 py-3 font-medium">{{ row.vendor.shop_name }}</td>
          <td class="px-4 py-3">Rs. {{ row.total_revenue }}</td>
          <td class="px-4 py-3">Rs. {{ row.admin_commission }}</td>
          <td class="px-4 py-3">Rs. {{ row.vendor_earning }}</td>
          <td class="px-4 py-3">Rs. {{ row.wallet }}</td>
          <td class="px-4 py-3">Rs. {{ row.pending }}</td>
          <td class="px-4 py-3 text-center">
            <a href="{% url 'admin_vendor_payments_detail' row.vendor.id %}" title="View Payment Details" class="text-blue-600 hover:text-blue-800">
              <i class="fas fa-eye"></i>
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" class="px-4 py-6 text-center text-gray-500">No vendors match the search criteria.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  $(document).ready(function() {
    $('#vendorPaymentsTable').DataTable({
      pageLength: 10,
      lengthChange: true,
      searching: true,
      ordering: true,
      responsive: true,
      language: {
        search: "_INPUT_",
        searchPlaceholder: "Search vendors..."
      },
      columnDefs: [
        { orderable: false, targets: 6 } // Disable sorting on Actions column
      ]
    });
  });
</script>
{% endblock %}
