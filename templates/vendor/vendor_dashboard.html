{% extends 'dashboard/components/base.html' %}
{% load static %}

{% block content %}
<section class="px-4 sm:px-6 lg:px-8 py-6">

  <!-- Page Heading -->
  <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-6 flex items-center gap-2">
    <i class="fas fa-store text-blue-600"></i> Vendor Dashboard
  </h1>

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
    
    <!-- Products Card -->
    <div class="bg-white p-5 sm:p-6 rounded-lg shadow-md border border-gray-200 hover:shadow-lg transition">
      <div class="flex items-center gap-3 mb-3">
        <i class="fas fa-boxes text-2xl text-blue-500"></i>
        <h3 class="font-semibold text-gray-700">Products</h3>
      </div>
      <p class="text-gray-600 text-sm"><i class="fas fa-list-ul mr-1"></i> Total: {{ total_products }}</p>
      <p class="text-gray-600 text-sm"><i class="fas fa-check-circle mr-1"></i> Active: {{ active_products }}</p>
      <p class="text-gray-600 text-sm"><i class="fas fa-exclamation-triangle mr-1 text-yellow-600"></i> Low Stock: <span class="font-semibold">{{ low_stock_products }}</span></p>
    </div>

    <!-- Orders Card -->
    <div class="bg-white p-5 sm:p-6 rounded-lg shadow-md border border-gray-200 hover:shadow-lg transition">
      <div class="flex items-center gap-3 mb-3">
        <i class="fas fa-shopping-cart text-2xl text-green-500"></i>
        <h3 class="font-semibold text-gray-700">Orders</h3>
      </div>
      <p class="text-gray-600 text-sm"><i class="fas fa-list-ul mr-1"></i> Total: {{ total_orders }}</p>
      <p class="text-gray-600 text-sm"><i class="fas fa-clock mr-1 text-yellow-600"></i> Pending: <span class="font-semibold">{{ pending_orders }}</span></p>
      <p class="text-gray-600 text-sm"><i class="fas fa-check mr-1 text-green-600"></i> Delivered: <span class="font-semibold">{{ delivered_orders }}</span></p>
      <p class="text-gray-600 text-sm"><i class="fas fa-money-bill-wave mr-1"></i> Revenue: Rs. <span class="font-semibold">{{ total_revenue }}</span></p>
    </div>

    <!-- Profile Card -->
    <div class="bg-white p-5 sm:p-6 rounded-lg shadow-md border border-gray-200 hover:shadow-lg transition">
      <div class="flex items-center gap-3 mb-3">
        <i class="fas fa-user-circle text-2xl text-purple-500"></i>
        <h3 class="font-semibold text-gray-700">Profile</h3>
      </div>
      <p class="text-gray-600 text-sm"><i class="fas fa-user mr-1"></i> Name: {{ request.user.get_full_name }}</p>
      <p class="text-gray-600 text-sm"><i class="fas fa-envelope mr-1"></i> Email: {{ request.user.email }}</p>
      <p class="text-gray-600 text-sm"><i class="fas fa-store mr-1"></i> Shop: {{ request.user.vendor.shop_name }}</p>
    </div>

  </div>

  <!-- Charts Section -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">

    <!-- Orders Status Pie Chart -->
    <div class="bg-white p-5 sm:p-6 rounded-lg shadow-md border border-gray-200 hover:shadow-lg transition">
      <h3 class="font-semibold text-gray-700 mb-4 flex items-center gap-2">
        <i class="fas fa-chart-pie text-blue-500"></i> Orders Status
      </h3>
      <canvas id="orderChart" class="w-full h-64 sm:h-72"></canvas>
    </div>

    <!-- Product Stock Bar Chart -->
    <div class="bg-white p-5 sm:p-6 rounded-lg shadow-md border border-gray-200 hover:shadow-lg transition">
      <h3 class="font-semibold text-gray-700 mb-4 flex items-center gap-2">
        <i class="fas fa-box text-yellow-500"></i> Product Stock Status
      </h3>
      <canvas id="productChart" class="w-full h-64 sm:h-72"></canvas>
    </div>

  </div>

  <!-- Monthly Revenue Line Chart -->
  <div class="bg-white p-5 sm:p-6 rounded-lg shadow-md border border-gray-200 hover:shadow-lg transition">
    <h3 class="font-semibold text-gray-700 mb-4 flex items-center gap-2">
      <i class="fas fa-chart-line text-green-500"></i> Revenue (Last 30 Days)
    </h3>
    <canvas id="revenueChart" class="w-full h-72"></canvas>
  </div>

</section>
{% endblock %}

{% block extra_js %}
<!-- Chart.js -->

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script>
$(function () {
  // Prepare data safely
  const pending = {{ pending_orders|default:0 }};
  const delivered = {{ delivered_orders|default:0 }};
  const totalProducts = {{ total_products|default:0 }};
  const lowStock = {{ low_stock_products|default:0 }};
  const labels = {{ chart_labels|safe|default:"[]" }};
  const revenues = {{ chart_data|safe|default:"[]" }};

  // Chart.js global style
  Chart.defaults.font.family = "'Inter', sans-serif";
  Chart.defaults.plugins.tooltip.backgroundColor = 'rgba(0,0,0,0.7)';

  // Order Status Pie Chart
  const ctxOrder = $('#orderChart');
  new Chart(ctxOrder, {
    type: 'doughnut',
    data: {
      labels: ['Pending', 'Delivered'],
      datasets: [{
        data: [pending, delivered],
        backgroundColor: ['#f59e0b','#10b981'],
        borderWidth: 1.5,
        hoverOffset: 10
      }]
    },
    options: {
      cutout: '70%',
      plugins: {
        legend: { position: 'bottom' },
        title: { display: true, text: 'Order Status Overview' }
      }
    }
  });

  // Product Stock Bar Chart
  const ctxProduct = $('#productChart');
  new Chart(ctxProduct, {
    type: 'bar',
    data: {
      labels: ['Total Products', 'Low Stock'],
      datasets: [{
        label: 'Product Count',
        data: [totalProducts, lowStock],
        backgroundColor: ['#3b82f6', '#f59e0b'],
        borderRadius: 6,
        hoverBackgroundColor: ['#2563eb', '#d97706']
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: {
        y: { beginAtZero: true, ticks: { stepSize: 1 } }
      }
    }
  });

  // Revenue Line Chart
  const ctxRevenue = $('#revenueChart');
  const gradient = ctxRevenue[0].getContext('2d').createLinearGradient(0, 0, 0, 400);
  gradient.addColorStop(0, 'rgba(16,185,129,0.5)');
  gradient.addColorStop(1, 'rgba(16,185,129,0)');

  new Chart(ctxRevenue, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Daily Revenue (Rs)',
        data: revenues,
        fill: true,
        borderColor: '#10b981',
        backgroundColor: gradient,
        tension: 0.4,
        pointBackgroundColor: '#10b981',
        pointRadius: 4,
        pointHoverRadius: 6
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        title: { display: true, text: 'Last 30 Days Revenue' }
      },
      scales: {
        y: { beginAtZero: true, title: { display: true, text: 'Revenue (Rs)' } },
        x: { title: { display: true, text: 'Date' } }
      }
    }
  });
});
</script>
{% endblock %}
