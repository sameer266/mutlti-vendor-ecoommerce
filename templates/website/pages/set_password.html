{% extends 'website/components/base.html' %}

{% block title %}Change Password{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center bg-[var(--bg-light)] py-12 px-4">
  <div class="max-w-md w-full bg-white rounded-lg shadow-md p-8 space-y-6">

    <!-- Title -->
    <div class="text-center">
      <h2 class="text-2xl font-bold text-[var(--text-primary)]">Change Password</h2>
      <p class="text-gray-500 mt-1">Enter your new password below</p>
    </div>

    <!-- Form -->
    <form id="changePasswordForm" method="POST" action="">
      {% csrf_token %}

      <!-- New Password -->
      <div class="mb-4">
        <label for="new_password" class="block text-sm font-semibold text-gray-700">New Password</label>
        <input type="password" name="new_password" id="new_password" required
               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:ring-[var(--primary)] focus:border-[var(--primary)] sm:text-sm"
               placeholder="Enter new password">
        <small id="newPassError" class="text-red-500 text-xs hidden">Password must be at least 8 characters long</small>
      </div>

      <!-- Confirm Password -->
      <div class="mb-4">
        <label for="confirm_password" class="block text-sm font-semibold text-gray-700">Confirm Password</label>
        <input type="password" name="confirm_password" id="confirm_password" required
               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:ring-[var(--primary)] focus:border-[var(--primary)] sm:text-sm"
               placeholder="Re-enter new password">
        <small id="confirmPassError" class="text-red-500 text-xs hidden">Passwords do not match</small>
      </div>

      <!-- Submit -->
      <div>
        <button type="submit"
                class="w-full py-2 px-4 bg-[var(--bg-brown)] text-white font-semibold rounded-lg hover:bg-[var(--primary-dark)] transition">
          Update Password
        </button>
      </div>
    </form>

    <!-- Back to Login -->
    <p class="text-center text-gray-500 text-sm mt-4">
      <a href="{% url 'login_page' %}" class="text-[var(--primary)] font-semibold hover:text-[var(--primary-dark)]">Back to Login</a>
    </p>

  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
  $(document).ready(function () {
    $("#changePasswordForm").on("submit", function (e) {
      let newPass = $("#new_password").val().trim();
      let confirmPass = $("#confirm_password").val().trim();
      let isValid = true;

      // Hide old errors
      $("#newPassError, #confirmPassError").addClass("hidden");

      // Check length
      if (newPass.length < 8) {
        $("#newPassError").removeClass("hidden");
        isValid = false;
      }

      // Check match
      if (newPass !== confirmPass) {
        $("#confirmPassError").removeClass("hidden");
        isValid = false;
      }

      // Stop form submit if invalid
      if (!isValid) {
        e.preventDefault();
      }
    });

    // Optional: live validation while typing
    $("#confirm_password").on("input", function () {
      if ($("#new_password").val() === $(this).val()) {
        $("#confirmPassError").addClass("hidden");
      } else {
        $("#confirmPassError").removeClass("hidden");
      }
    });
  });
</script>


{% endblock %}

