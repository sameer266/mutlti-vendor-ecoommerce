{% extends 'website/components/base.html' %}
{% load static %}

{% block title %}Invoice {{ invoice.invoice_number }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 lg:py-12">
  <div class="flex flex-col lg:flex-row gap-6 lg:gap-8">

    <!-- Sidebar -->
    <aside class="w-full lg:w-64 flex-shrink-0">
      {% include 'website/components/customer_sidebar.html' %}
    </aside>

    <!-- Invoice Section -->
    <div class="flex-1">
      <div class="bg-white shadow rounded-2xl border border-gray-100 p-6 sm:p-8" id="invoice-section">

        <!-- Header -->
        <div class="flex justify-between items-center mb-6">
          <div>
            <h1 class="text-2xl font-bold text-gray-900">Invoice</h1>
            <p class="text-gray-500">Invoice #: {{ invoice.invoice_number }}</p>
            <p class="text-gray-500">Order #: {{ invoice.order.order_number }}</p>
          </div>
          <div class="text-right">
            <p class="text-sm text-gray-600">Date: {{ invoice.created_at|date:"M d, Y h:i A" }}</p>
            <p class="text-sm text-gray-600">
              Payment Status:
              <span class="font-semibold
                {% if invoice.payment_status == 'pending' %}text-yellow-600
                {% elif invoice.payment_status == 'paid' %}text-green-600
                {% elif invoice.payment_status == 'failed' %}text-red-600
                {% endif %}">
                {{ invoice.payment_status|capfirst }}
              </span>
            </p>
          </div>
        </div>

        <!-- Customer & Vendor Info -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-6">
          <div>
            <h3 class="font-semibold text-gray-700 mb-2">Billed To</h3>
            <p>{{ invoice.customer.get_full_name }}</p>
            <p>{{ invoice.customer.profile.phone }}</p>
          </div>
          <div>
            <h3 class="font-semibold text-gray-700 mb-2">Vendor</h3>
            <p class="font-semibold">{{ invoice.vendor.shop_name }}</p>
            <p>{{ invoice.vendor.name }}</p>
            <p>{{ invoice.vendor.email }}</p>
          </div>
        </div>

        <!-- Invoice Items Table -->
        <div class="overflow-x-auto mb-6">
          <table class="min-w-full divide-y divide-gray-200 border">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-4 py-2 text-left text-sm font-medium text-gray-500 uppercase">Product</th>
                <th class="px-4 py-2 text-left text-sm font-medium text-gray-500 uppercase">Qty</th>
                <th class="px-4 py-2 text-left text-sm font-medium text-gray-500 uppercase">Price</th>
                <th class="px-4 py-2 text-left text-sm font-medium text-gray-500 uppercase">Total</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200 bg-white">
              {% for item in invoice.order.items.all %}
              <tr>
                <td class="px-4 py-2 text-sm text-gray-700">{{ item.product.name }}</td>
                <td class="px-4 py-2 text-sm text-gray-700">{{ item.quantity }}</td>
                <td class="px-4 py-2 text-sm text-gray-700">Rs {{ item.price }}</td>
                <td class="px-4 py-2 text-sm text-gray-700">Rs {{ item.get_total }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- Totals -->
        <div class="flex justify-end">
          <div class="w-full sm:w-1/2">
            <div class="flex justify-between py-1 text-gray-700">
              <span>Subtotal:</span>
              <span>Rs {{ invoice.subtotal }}</span>
            </div>
            <div class="flex justify-between py-1 text-gray-700">
              <span>Tax ({{ tax_rate }}%):</span>
              <span>Rs {{ invoice.tax_amount }}</span>
            </div>
            <div class="flex justify-between py-1 text-gray-700">
              <span>Shipping:</span>
              <span>Rs {{ shipping_cost }}</span>
            </div>
            <div class="flex justify-between py-1 text-gray-700">
              <span>Discount:</span>
              <span>Rs {{ invoice.discount }}</span>
            </div>
            <div class="flex justify-between py-2 text-lg font-semibold text-gray-900 border-t border-gray-200 mt-2">
              <span>Total:</span>
              <span>Rs {{ invoice.total }}</span>
            </div>
          </div>
        </div>

        <!-- Notes -->
        {% if invoice.notes %}
        <div class="mt-6">
          <h4 class="font-semibold text-gray-700 mb-1">Notes:</h4>
          <p class="text-gray-600">{{ invoice.notes }}</p>
        </div>
        {% endif %}
      </div>

      <!-- Buttons -->
      <div class="mt-6 flex justify-between items-center">
        <a href="{% url 'customer_invoices' %}"
           class="inline-flex items-center gap-2 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">
          <i class="fa-solid fa-arrow-left"></i> Back
        </a>

        <div class=" ">
         
          <button onclick="printInvoice()" class="inline-flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
            <i class="fa-solid fa-print"></i> Print Invoice
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Print Script -->
<script>
function printInvoice() {
  const printContents = document.getElementById("invoice-section").innerHTML;
  const originalContents = document.body.innerHTML;
  document.body.innerHTML = printContents;
  window.print();
  document.body.innerHTML = originalContents;
  location.reload();
}
</script>
{% endblock %}
