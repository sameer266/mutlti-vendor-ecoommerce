{% extends 'website/components/base.html' %}

{% block title %}Shopping Cart{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">

  <div class="flex flex-col xl:flex-row gap-6">

    <!-- Cart Items -->
    <div class="flex-1 order-2 xl:order-1">
      <div class="bg-white rounded-lg shadow-sm p-4">

        <!-- Responsive Table Wrapper -->
        <div class="overflow-x-auto">
          <table class="w-full table-auto border-collapse text-[var(--text-primary)] min-w-[600px]">
            <thead>
              <tr class="bg-gray-100 shadow-sm">
                <th class="text-left px-3 py-2">Product</th>
                <th class="text-center px-3 py-2">Price</th>
                <th class="text-center px-3 py-2">Quantity</th>
                <th class="text-left px-3 py-2">Subtotal</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <tr class="cart-item hover:bg-gray-50 transition">
                <td class="px-3 py-2 flex items-center space-x-3">
                  <img src="https://miterimart.com.au/storage/products/featured/DQb1htwCqaaLSmCSLHBhjnvpVkN7WrRYscFERpij.jpg" class="w-20 h-20 rounded object-cover">
                  <div>
                    <h6 class="font-semibold text-[var(--text-primary)]">Miller's Vegetable Oil 4L</h6>
                    <span class="text-gray-500 text-sm">SKU: MVO45767</span>
                  </div>
                </td>
                <td class="text-center item-price font-semibold text-[var(--primary)]">$14.50</td>
                <td class="text-center">
                  <div class="inline-flex items-center space-x-1">
                    <button class="decreaseQty px-1 py-1 border rounded text-gray-700 text-sm">-</button>
                    <input type="text" value="1" class="w-10 text-center border rounded text-sm qtyInput">
                    <button class="increaseQty px-1 py-1 border rounded text-gray-700 text-sm">+</button>
                  </div>
                </td>
                <td class="text-left item-subtotal font-semibold text-gray-600">$14.50</td>
                <td class="text-center">
                  <button class="text-red-500 hover:text-red-700 removeItem"><i class="fa fa-times"></i></button>
                </td>
              </tr>

              <tr class="cart-item hover:bg-gray-50 transition">
                <td class="px-3 py-2 flex items-center space-x-3">
                  <img src="https://miterimart.com.au/storage/products/featured/DQb1htwCqaaLSmCSLHBhjnvpVkN7WrRYscFERpij.jpg" class="w-20 h-20 rounded object-cover">
                  <div>
                    <h6 class="font-semibold text-[var(--text-primary)]">Fortune Everyday Basmati 5kg</h6>
                    <span class="text-gray-500 text-sm">SKU: FEB4758</span>
                  </div>
                </td>
                <td class="text-center item-price font-semibold text-[var(--primary)]">$13.99</td>
                <td class="text-center">
                  <div class="inline-flex items-center space-x-1">
                    <button class="decreaseQty px-1 py-1 border rounded text-gray-700 text-sm">-</button>
                    <input type="text" value="1" class="w-10 text-center border rounded text-sm qtyInput">
                    <button class="increaseQty px-1 py-1 border rounded text-gray-700 text-sm">+</button>
                  </div>
                </td>
                <td class="text-left item-subtotal font-semibold text-gray-600">$13.99</td>
                <td class="text-center">
                  <button class="text-red-500 hover:text-red-700 removeItem"><i class="fa fa-times"></i></button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Subtotal Display -->
        <div class="flex justify-start mt-4 border-t pt-4 text-gray-600 font-semibold">
          <span>Subtotal: </span>
          <span id="cartSubtotal" class="ml-2 text-gray-600">$28.49</span>
        </div>
      </div>
    </div>

    <!-- Order Summary / Checkout -->
    <div class="w-full xl:w-1/3 order-1 xl:order-2">
      <div class="bg-white rounded-lg shadow-sm p-4 space-y-4">
        <h5 class="font-bold text-[var(--text-primary)] text-lg">Order Summary</h5>
        <div class="flex justify-between text-[var(--text-primary)]">
          <span>Subtotal:</span>
          <span id="summarySubtotal" class="text-gray-600">$28.49</span>
        </div>
        <div class="flex justify-between text-[var(--text-primary)]">
          <span>Tax (5%):</span>
          <span id="summaryTax" class="text-gray-600">$1.42</span>
        </div>
        <div class="flex justify-between font-bold text-[var(--bg-brown)] text-lg border-t pt-2">
          <span>Total:</span>
          <span id="summaryTotal">$29.91</span>
        </div>

        <div class="flex flex-col gap-2 mt-4">
          <button class="bg-[var(--bg-brown)] text-white py-2 rounded hover:bg-[var(--primary-dark)] transition font-semibold flex items-center justify-center gap-2">
            Customer Checkout <i class="fa-solid fa-arrow-right-to-bracket"></i>
          </button>
          <button class="bg-gray-300 text-[var(--text-primary)] py-2 rounded hover:bg-gray-400 transition font-semibold flex items-center justify-center gap-2">
            Guest Checkout <i class="fa-solid fa-user-secret"></i>
          </button>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
$(document).ready(function() {
  toastr.options = {
    "closeButton": true,
    "progressBar": true,
    "positionClass": "toast-top-right",
    "timeOut": "2000"
  };

  function updateCartTotals() {
    let subtotal = 0;
    $('.cart-item').each(function() {
      const price = parseFloat($(this).find('.item-price').text().replace('$',''));
      const qty = parseInt($(this).find('.qtyInput').val());
      const itemSubtotal = price * qty;
      $(this).find('.item-subtotal').text(`$${itemSubtotal.toFixed(2)}`);
      subtotal += itemSubtotal;
    });

    const tax = subtotal * 0.05;
    const total = subtotal + tax;

    $('#cartSubtotal, #summarySubtotal').text(`$${subtotal.toFixed(2)}`);
    $('#summaryTax').text(`$${tax.toFixed(2)}`);
    $('#summaryTotal').text(`$${total.toFixed(2)}`);
  }

  $('.increaseQty').click(function() {
    const $input = $(this).siblings('.qtyInput');
    $input.val(parseInt($input.val()) + 1);
    updateCartTotals();
  });

  $('.decreaseQty').click(function() {
    const $input = $(this).siblings('.qtyInput');
    const val = Math.max(1, parseInt($input.val()) - 1);
    $input.val(val);
    updateCartTotals();
  });

  $('.removeItem').click(function() {
    $(this).closest('.cart-item').remove();
    updateCartTotals();
    toastr.success("Item removed from cart");
  });
});
</script>
{% endblock %}
